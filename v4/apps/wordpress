{"captainVersion":4,"services":{"$$cap_appname-wordpress":{"image":"wordpress:latest","depends_on":["$$cap_appname-db"],"environment":{"WORDPRESS_DB_HOST":"srv-captain--$$cap_appname-db:3306","WORDPRESS_DB_USER":"$$cap_wordpress_db_user","WORDPRESS_DB_PASSWORD":"$$cap_wordpress_db_password","WORDPRESS_DB_NAME":"$$cap_wordpress_db_name"},"volumes":["wordpress_data:/var/www/html"],"restart":"always","ports":["80:80"],"caproverExtra":{"containerHttpPort":"80"}},"$$cap_appname-db":{"image":"mysql:5.7","environment":{"MYSQL_DATABASE":"$$cap_wordpress_db_name","MYSQL_USER":"$$cap_wordpress_db_user","MYSQL_PASSWORD":"$$cap_wordpress_db_password","MYSQL_ROOT_PASSWORD":"$$cap_mysql_root_password"},"volumes":["db_data:/var/lib/mysql"],"restart":"always","caproverExtra":{"notExposeAsWebApp":"true"}},"$$cap_appname-sftp":{"image":"atmoz/sftp","ports":["22:22"],"volumes":["sftp_data:/home","sftp_users:/etc/sftp/users.conf"],"restart":"always"},"$$cap_appname-sftp-api":{"image":"python:3.9-slim","environment":{"SFTP_CONFIG_PATH":"/etc/sftp/users.conf"},"volumes":["sftp_users:/etc/sftp/users.conf"],"ports":["5000:5000"],"command":"sh -c \"\n  echo 'Flask==2.0.2' > requirements.txt &&\n  pip install -r requirements.txt &&\n  echo '\n  from flask import Flask, request, jsonify\n  app = Flask(__name__)\n  SFTP_CONFIG_PATH = \\\"/etc/sftp/users.conf\\\"\n  def add_user_to_sftp(username, password):\n    with open(SFTP_CONFIG_PATH, \\\"a\\\") as file:\n      file.write(f\\\"{username}:{password}:1001\\\\n\\\")\n  @app.route(\\\"/add_sftp_user\\\", methods=[\\\"POST\\\"])\n  def add_sftp_user():\n    data = request.json\n    username = data.get(\\\"username\\\")\n    password = data.get(\\\"password\\\")\n    if not username or not password:\n      return jsonify({\\\"error\\\": \\\"Username and password are required\\\"}), 400\n    add_user_to_sftp(username, password)\n    return jsonify({\\\"message\\\": \\\"User added successfully\\\"}), 201\n  if __name__ == \\\"__main__\\\":\n    app.run(host=\\\"0.0.0.0\\\", port=5000)\n  ' > app.py &&\n  python app.py\n\"\n","restart":"always"}},"volumes":{"wordpress_data":null,"db_data":null,"sftp_data":null,"sftp_users":null},"caproverOneClickApp":{"variables":[{"id":"$$cap_wordpress_db_name","label":"WordPress Database Name","defaultValue":"wordpress"},{"id":"$$cap_wordpress_db_user","label":"WordPress Database User","defaultValue":"wordpress"},{"id":"$$cap_wordpress_db_password","label":"WordPress Database Password","defaultValue":"$$cap_gen_random_hex(16)"},{"id":"$$cap_mysql_root_password","label":"MySQL Root Password","defaultValue":"$$cap_gen_random_hex(16)"}],"instructions":{"start":"Deploying WordPress with MySQL, SFTP, and SFTP API...","end":"Your WordPress application is deployed and available at http://$$cap_appname.$$cap_root_domain"},"displayName":"WordPress with MySQL, SFTP, and SFTP API","isOfficial":false,"description":"This setup deploys WordPress with a MySQL database, SFTP, and an API to manage SFTP users.","documentation":"https://wordpress.org/support/article/how-to-install-wordpress/"}}
